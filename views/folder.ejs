<div class="folder-content">
  <%- include('partials/shared/messages') %>
  <div class="folder-header">
    <h1 class="folder-title">
      <div class="folder-title-icon">
        <img src="/icon/folder.png" alt="Folder" />
      </div>
      <%= currentFolder.name %>
    </h1>
    <%- include('partials/folder/breadcrumb', { currentFolder: currentFolder })
    %>
  </div>
  <div class="stats-section">
    <h2 class="section-title">Folder Overview</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <img src="/icon/files.png" alt="File" class="stat-image-icon" />
        </div>
        <div class="stat-content">
          <h3 class="stat-number">
            <%= pagination ? pagination.totalFiles : (currentFolder._count ?
            currentFolder._count.files : 0) %>
          </h3>
          <p class="stat-label">Files</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <img src="/icon/folder.png" alt="Subfolder" class="stat-image-icon" />
        </div>
        <div class="stat-content">
          <h3 class="stat-number">
            <%= currentFolder._count ? currentFolder._count.children : 0 %>
          </h3>
          <p class="stat-label">Subfolders</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <img
            src="/icon/calendar.png"
            alt="Calendar"
            class="stat-image-icon"
          />
        </div>
        <div class="stat-content">
          <h3 class="stat-number">
            <%= new Date(currentFolder.createdAt).toLocaleDateString() %>
          </h3>
          <p class="stat-label">Created</p>
        </div>
      </div>
    </div>
  </div>
  <div class="action-buttons">
    <button
      class="btn btn-primary"
      onclick="openCreateFolderModal(<%= currentFolder.id %>)"
    >
      <div class="button-icon">
        <img src="/icon/folder.png" alt="Folder" class="button-image-icon" />
      </div>
      New Subfolder
    </button>

    <button
      class="btn btn-upload"
      onclick="document.getElementById('folderFileInput').click()"
    >
      <div class="button-icon">
        <img src="/icon/upload.png" alt="Files" class="button-image-icon" />
      </div>
      Add Files
    </button>

    <% if (currentFolder.parentId) { %>
    <a href="/folder/<%= currentFolder.parentId %>" class="btn btn-outline">
      <div class="button-icon">
        <img src="/icon/back.png" alt="Parent" class="button-image-icon" />
      </div>
      Go to Parent
    </a>
    <% } else { %>
    <a href="/dashboard" class="btn btn-outline">
      <div class="button-icon">
        <img src="/icon/back.png" alt="Dashboard" class="button-image-icon" />
      </div>
      Back to Dashboard
    </a>
    <% } %>
  </div>
  <!-- Share Section (pliante) -->
  <div class="collapsible-header" id="share-section-header">
    <h3 class="collapsible-header-title">
      <div class="share-form-icon">
        <img src="/icon/share.png" alt="Share" />
      </div>
      Share this folder
    </h3>
    <button class="content-toggle" data-target="share-content">
      <i class="icon-sm">▶</i>
    </button>
  </div>
  <div
    class="collapsible-content"
    id="share-content"
    data-content-id="share-<%= currentFolder.id %>"
  >
    <div class="share-form-box">
      <div class="share-form-title">
        <div class="share-form-icon">
          <img src="/icon/share.png" alt="Share" />
        </div>
        <h3 class="share-form-title-text">Share this folder</h3>
      </div>

      <p class="share-description">
        Generate a link to share this folder with anyone. They will be able to
        view and download files without needing an account.
      </p>

      <% if (typeof shareUrl !== 'undefined' && shareUrl) { %>
      <div class="share-link-generated">
        <div class="share-link-header">
          <div class="share-link-success-icon">
            <img src="/icon/link.png" alt="Link" />
          </div>
          <div class="share-link-success-content">
            <strong class="share-link-success-title"
              >Share link created!</strong
            >
            <p class="share-link-success-subtitle">
              Valid for <%= req.session.shareDuration || 7 %> days
            </p>
          </div>
        </div>

        <input
          type="text"
          value="<%= shareUrl %>"
          readonly
          class="share-link-input"
        />

        <button class="copy-btn" data-copy="<%= shareUrl %>">
          <div class="copy-btn-icon">
            <img src="/icon/copy.png" alt="Copy" />
          </div>
          Copy Link
        </button>

        <p class="share-link-note">
          Share this link with anyone. They can view and download files without
          logging in.
        </p>
      </div>
      <% } %>

      <form action="/folders/<%= currentFolder.id %>/share" method="POST">
        <div class="share-form-fields">
          <div class="share-field-group">
            <label for="duration" class="share-field-label">
              Link duration
            </label>
            <select
              name="duration"
              id="duration"
              class="share-field-select"
              required
            >
              <option value="1">1 day</option>
              <option value="7" selected>7 days</option>
              <option value="30">30 days</option>
              <option value="90">90 days</option>
              <option value="365">1 year</option>
            </select>
          </div>

          <button type="submit" class="btn btn-primary share-generate-btn">
            <div class="share-icon share-generate-icon">
              <img src="/icon/share.png" alt="Share" />
            </div>
            Generate Share Link
          </button>
        </div>

        <div class="share-form-note">
          <div class="share-form-note-icon">
            <img src="/icon/clock.png" alt="Note" />
          </div>
          <span class="share-form-note-text">
            The link will automatically expire after the selected duration.
          </span>
        </div>
      </form>

      <div class="share-form-footer">
        <a href="/shares" class="btn btn-secondary share-all-links-btn">
          <div class="share-icon share-all-links-icon">
            <img src="/icon/share.png" alt="My shares" />
          </div>
          View all my share links
        </a>
      </div>
    </div>
  </div>
  <!-- Upload Section (pliante) -->
  <div class="collapsible-header" id="upload-section-header">
    <h3 class="collapsible-header-title">
      <div class="section-icon">
        <img src="/icon/cloud.png" alt="Upload" />
      </div>
      Upload files
    </h3>
    <button class="content-toggle" data-target="upload-content">
      <i class="icon-sm">▶</i>
    </button>
  </div>
  <div
    class="collapsible-content"
    id="upload-content"
    data-content-id="upload-<%= currentFolder.id %>"
  >
    <%- include('partials/folder/upload-section', { currentFolder: currentFolder
    }) %>
  </div>
  <!-- Subfolders Section (pliante) -->
  <div
    class="collapsible-section"
    data-section-id="subfolders-<%= currentFolder.id %>"
    data-default-state="open"
  >
    <div class="section-header">
      <div class="section-header-left">
        <h2 class="section-title">
          <div class="section-icon">
            <img src="/icon/folder.png" alt="Subfolders" class="icon-md" />
          </div>
          Subfolders
          <span class="file-count">
            <%= folders ? folders.length : 0 %> folder<%= folders &&
            folders.length !== 1 ? 's' : '' %>
          </span>
        </h2>
      </div>
      <div class="section-header-right">
        <button class="section-toggle">
          <i class="icon-sm">▼</i>
        </button>
      </div>
    </div>
    <div class="section-content">
      <% if (folders && folders.length > 0) { %> <%-
      include('partials/shared/folder-grid', { folders: folders }) %> <% } else
      { %>
      <div class="empty-state small">
        <div class="empty-icon">
          <img
            src="/icon/folder.png"
            alt="Empty folder"
            class="empty-image-icon"
          />
        </div>
        <p class="empty-state-text">No subfolders in this folder</p>
        <button
          class="btn btn-outline"
          onclick="openCreateFolderModal(<%= currentFolder.id %>)"
        >
          Create First Subfolder
        </button>
      </div>
      <% } %>
    </div>
  </div>
  <!-- Files in this folder Section (pliante) -->
  <div
    class="collapsible-section"
    data-section-id="files-<%= currentFolder.id %>"
    data-default-state="closed"
  >
    <div class="section-header">
      <div class="section-header-left">
        <h2 class="section-title">
          <div class="section-icon">
            <img src="/icon/files.png" alt="Files" class="icon-md" />
          </div>
          Files in this folder
          <span class="file-count">
            <%= pagination ? pagination.totalFiles : (files ? files.length : 0)
            %> file<%= (pagination ? pagination.totalFiles : (files ?
            files.length : 0)) !== 1 ? 's' : '' %>
          </span>
        </h2>
      </div>
      <div class="section-header-right">
        <button class="section-toggle">
          <i class="icon-sm">▶</i>
        </button>
      </div>
    </div>
    <div class="section-content">
      <%- include('partials/folder/folder-files', { files: files }) %> <% if
      (pagination && pagination.totalPages > 1) { %> <%-
      include('partials/shared/pagination') %> <% } %>
    </div>
  </div>

  <!-- Modals -->
  <%- include('partials/shared/modals') %>
</div>
